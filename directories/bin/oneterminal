#!/usr/bin/bash
#Maintained in linux-init-files.org

sessionname="${1:-`pwd`}"
title="${ONETERM_TITLE:-${sessionname}}"
#sessionname="${sessionname//[^[:alnum:]]/}"
script="${2}"
tflags="${3}"

profile="${ONETERM_PROFILE:-"$(hostname)"}"

if ! sway-do-tool "$title"; then
    logger -t "oneterminal" "Didn't find a terminal $title so starting a terminal"
    logger -t "oneterminal" "and attaching a session ${sessionname}"
    logger -t "oneterminal" "if it exists else created with script ${script}."
    alacritty --title "${title}" --command bash -c "tmux new-session -A -s ${sessionname} ${script}"
else
    logger -t "oneterminal" "Found an existing terminal $title."
    if ! tmux has-session -t  "${sessionname}"; then
        logger -t "oneterminal" "It wasnt attached to session ${sessionname} so attaching it."
        tmux attach -t "${sessionname}"
    else
        logger -t "oneterminal" "It was already attched to session ${sessionname}"
    fi
fi
exit 0
