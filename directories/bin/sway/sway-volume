#!/usr/bin/env bash
# Maintained in linux-config.org

getVolume(){
    if [ "$(pactl list sinks | grep Mute | awk '{print $2}')" = "yes" ]; then
        echo "off"
    else
        echo "$(pactl list sinks | grep '^[[:space:]]Volume:' | head -n $(( $SINK + 1 )) | tail -n 1 | sed -e 's,.* \([0-9][0-9]*\)%.*,\1,')"
    fi
}

v="$1"

case "$v" in
    "on"|"off"|"toggle")
        pactl set-sink-mute @DEFAULT_SINK@  "$([ "$v" = "off" ] && echo "1" || ( [ "$v" = "on" ] && echo "0" || echo "toggle"))"
        volume="$(pactl list sinks | grep Mute | awk '{print $2}')"
        echo "$volume"
        ;;
    *)
        if [ -z "$v" ];then
            volume="$(getVolume)"
        else
            pactl set-sink-volume @DEFAULT_SINK@ "$v"
            sway-volume-mute "no" &> /dev/null
            volume="$(getVolume)"
            if [ $volume -gt 100 ]; then
                volume="100"
                pactl set-sink-volume @DEFAULT_SINK@ "$volume%";
            fi
        fi
        ;;
esac

echo "$volume"
