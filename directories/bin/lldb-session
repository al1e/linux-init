#!/usr/bin/env bash
# Maintained in linux-config.org
directory="$(realpath -s "${1:-`pwd`}")"
cd "${directory}"
session="${2:-${directory//[^[:alnum:]]/}}"
if ! tmux has-session -t "${session}" &> /dev/null; then
    tmux new-session -c ${directory} -d -s "${session}" -x - -y - "lldb && tmux kill-session -t ${session}"
    lldbPane=$(tmux display-message -p "#{pane_id}")
    # tmux send-keys -t  "$lldbpane" "lldb"  C-m
    tmux splitw -v -p 60 -t "$lldbPane" "voltron v c 'source list -a \$rip -c 32'"
    srcPane=$(tmux display-message -p "#{pane_id}")
    tmux splitw -h -p 66 -t "$srcPane" "voltron v c 'frame variable' --lexer c"
    localsPane=$(tmux display-message -p "#{pane_id}")
    tmux splitw -h -p 50 -t "$localsPane" "voltron v stack"
    stackPane=$(tmux display-message -p "#{pane_id}")
    tmux splitw -h -p 50 -t "$lldbPane" "voltron v backtrace"
    btPane=$(tmux display-message -p "#{pane_id}")
    tmux splitw -v -p 50 -t "$btPane" "voltron v breakpoints"
    breakpointsPane=$(tmux display-message -p "#{pane_id}")
     tmux select-pane -t "$lldbPane"
fi
echo "$session"
